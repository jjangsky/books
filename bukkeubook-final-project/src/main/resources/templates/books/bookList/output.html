<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet"  th:href="@{/css/books/bookList/bookList.css}">
<link rel="stylesheet"  th:href="@{/css/books/bookList/output.css}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
<div th:replace="/common/topSideBar.html"></div>
	<h2 class="mb-4" id="main-text"><a id="sub-a" href="/book/output">출고관리</a></h2>
    <hr><br><br>
    	
        <h5 class="mb-4" id="sub-text"><a id="sub-a" href="/book/output">출고신청</a></h5>
        <br>
		
		<div class="search-area" align="center">
			<form id="loginForm" action="/book/output" method="get" style="display: inline-block">
					<select th:with="searchCondition = ${selectCriteria.searchCondition}"
						id="searchCondition" name="searchCondition">
						<option value="select">--분류--</option>
						<option value="no" th:selected="${ searchCondition } == 'no'">도서코드</option>
						<option value="name" th:selected="${ searchCondition } == 'name'">제목</option>
						<option value="author" th:selected="${ searchCondition } == 'author'">저자</option>
					</select>
				<input type="text" style="display:none;"><!-- 엔터키 새로고침 방지용 -->
				<input type="hidden" name="currentPage" value="1">
				<input type="search" id="inputFind" name="searchValue" th:value="${selectCriteria.searchValue}">
				<button class="productBtn findBtn" id="findBtn" type="button">검색하기</button>
			</form>
		</div>
        <br>

        <!-- 이곳부터 화면구현 시작(샘플 테이블 지우고 구현 시작하시면 됩니다.) -->
        <div id="textTable" style="text-align:-webkit-center">
          <table id="sampleTable">
              <tr>
	            <th class="th1">도서코드</th>
	            <th class="th1">제목</th>
	            <th class="th1">저자</th>
	            <th class="th1">가격</th>
	            <th class="th1">창고보유재고</th>
	            <th class="th1">매장보유재고</th>
	            <th class="th1"></th>
       		  </tr>
              <tr class="tr1" th:each="bookList : ${ bookList }">
                <td class="td1" th:text="${ bookList.no }"></td>
                <td class="td2" id="td2" th:text="${ bookList.name }"></td>
                <td class="td3" th:text="${ bookList.author }"></td>
            	<td class="td4" th:text="${ #numbers.formatInteger(bookList.price, 3, 'COMMA') + '원' }"></td>
            	<td class="td5" th:text="${ bookList.whSt + ' ea' }"></td>
            	<td class="td6" th:text="${ bookList.storeSt + ' ea' }"></td>
            	<td class="td7"><button onclick="addList()" class="productBtn newBookBtn addBtn">추가</button></td>
              </tr>
          </table><br>
          <div th:replace="books/bookList/bookpagingInput2.html"></div>
          <br><br><br><br>   
          <div id="textTable" style="text-align:-webkit-center">
          <form action="/book/outputReceipt" method="post">
	          <table class="sampleTable" id="bottomTable">
	              <tr>
	                <th class="th1">도서코드</th>
	                <th class="th1">제목</th>
	                <th class="th1">저자</th>
	                <th class="th1">가격</th>
	                <th class="th1">창고보유재고</th>
	                <th class="th1">매장보유재고</th>
	                <th class="th1">출고수량</th>
	                <th class="th1"><button onclick="AllDel()" class="productBtn delBtn">전체삭제</button></th>
	              </tr>
	          </table><br><br>
	        <div id="newBookDiv">
	          <input type="hidden" id="rownum" name="rownum" value="0">
	          <button type="submit" class="productBtn newBookBtn" onclick="location.href='/book/outputReceipt'">출고신청</button>
	          <button type="button" class="productBtn newBookBtn backBtn">목록으로</button>
	        </div>      
         </form> 
        </div> <!------------------------ 본문 종료---------------------------->
	
	<br><br>
	<script th:inline="javascript">
		
		$('#findBtn').click(function(){
			if(inputFind.value == "" && searchCondition.value == 'select'){
				Swal.fire({
	                icon: 'question',
	                title: '',
	                text: '분류와 검색어를 입력 해 주세요.',
	            })} else if(inputFind.value == ""){
            	Swal.fire({
	                icon: 'question',
	                title: '',
	                text: '검색어를 입력 해 주세요.',
	                
            	})} else if(searchCondition.value == 'select'){
           		Swal.fire({
   	                icon: 'question',
   	                title: '',
   	                text: '분류를 선택 해 주세요.',
            	})} else{
		   			$('#loginForm').submit();
	   			};
			});
	</script>
	<script th:inline="javascript">
		
		$('.addBtn').click(function(){
			
			const table = document.getElementById("bottomTable");
			
			var bookInfo = new Array();
            var checkBtn = $(this);
            var tr = checkBtn.parent().parent();
            var td = tr.children();
            
            var whSt = td.eq(4).text();
            var bookNo = td.eq(0).text();
            
            if(whSt.substr(0 , 1) > 0){
	            
	            
	            
	            const newRow = table.insertRow();
	            
	            const newCell1 = newRow.insertCell(0);
	            const newCell2 = newRow.insertCell(1);
	            const newCell3 = newRow.insertCell(2);
	            const newCell4 = newRow.insertCell(3);
	            const newCell5 = newRow.insertCell(4);
	            const newCell6 = newRow.insertCell(5);
	            const newCell7 = newRow.insertCell(6);
	            const newCell8 = newRow.insertCell(7);
	            
	            var index = newRow.rowIndex;
	            var no = "no" + index;
	            var amount = "amount" + index;
	            console.log(bookNo);
	            
	            var test = document.getElementById("bottomTable").getElementsByTagName("tr")[1].getElementsByTagName("td")[0];
	            console.log(test);
	            
	            newCell1.innerHTML = td.eq(0).text()  + '<input type="hidden" name="' + no + '" value="' + td.eq(0).text() + '">';
	            newCell2.innerHTML = td.eq(1).text();
	            newCell3.innerHTML = td.eq(2).text();
	            newCell4.innerHTML = td.eq(3).text();
	            newCell5.innerHTML = td.eq(4).text();
	            newCell6.innerHTML = td.eq(5).text();
	            newCell7.innerHTML = '<input type="number" class="outputValue" name="' + amount + '" value="1" min="1">';
	            newCell8.innerHTML = '<input class="productBtn delBtn" type="button" value="삭제" onclick="SomeDeleteRowFunction(this)">';
	            
	            var rownum = document.getElementById("rownum");
	            rownum.value = index;
	            
	            
	            
	            
            } else {
            	Swal.fire({
                    icon: 'warning',
                    title: '재고수량을 확인 해 주세요!',
                    text: '수량이 1ea 이상인 도서만 출고 가능합니다.',
                })
            }
		})
	
	
	    /* 행 전체삭제 */
	    function AllDel(){
	      $('#bottomTable tr:not(:first)').remove();
	    }
	
	    /* 선택한 행 삭제 */
	    function SomeDeleteRowFunction(o){
	      var p=o.parentNode.parentNode;
	         p.parentNode.removeChild(p);
	    }   
	</script>
	
	<script th:inline="javascript">
    	  $().ready(function () {
		    $(".backBtn").click(function () {
		        Swal.fire({
		            title: '작성내용이 모두 사라집니다.',
		            text: "진행 하시겠습니까?",
		            icon: 'warning',
		            showCancelButton: true,
		            confirmButtonColor: '#c5bfbf',
		            cancelButtonColor: '#c5bfbf',
		            confirmButtonText: '승인',
		            cancelButtonText: '취소'
		        }).then((result) => {
		            if (result.isConfirmed) {
		            	location.href="/book/outputList";
		            }
		        })
		    });
		});
      </script> 

</body>
</html>